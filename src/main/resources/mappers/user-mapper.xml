<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC " -//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="user">

	<select id="getProfile" parameterType="string" resultType="UserDto">	<!-- 프로필을 가져올때 유저주소 전부를 가져옴 -->
		select name,rating_score,nickname,mobile_number,(select address from user_address ad where ad.user_id=us.user_id) from user us where user_id=#{userId}
	</select>
	
	<update id="updateAddressNo" parameterType="string">	<!-- 대표주소를 변경하기위해 주소순서를 하나씩 뒤로 민다 -->
		update user_address set address_no=address_no+1 from USER_ADDRESS where user_id=#{user_id}
	</update>
	
	<update id="updateMainAddress" parameterType="map">	<!--주소순서를 1로 바꿈으로써 대표주소 변경 -->
		update user_address set address_no=1 from user_address where user_id=#{user_id} and address_no=#{addressNo}+1
	</update>
	
	<insert id="insertAddress" parameterType="UserAddressDto">	<!-- 새로입력된 주소를 count+1 주소순서에 추가한다 -->
		insert into USER_ADDRESS values(#{address},#{detailAddress},#{userId},#{postCode},#{nickname},(select count(*) from user_address where user_id=#{user_id})+1)
	</insert>
	
	<select id="checkNickname" parameterType="string" resultType="_int">	<!-- 닉네임 중복검사 -->
		select count(*) from user where nickname=#{nickname}
	</select>
	
	<select id="checkEmail" parameterType="string" resultType="_int">		<!-- 이메일 중복검사 -->
		select count(*) from user where email=#{email} 
	</select>
	
	<select id="checkPass" parameterType="string" resultType="string" >		<!-- 패스워드를 가져온다 (패스워드 변경또는 로그인시 사용)-->
		select password from user where user_id=#{userId}
	</select>
	
	<update id="updatePass" parameterType="map">							<!-- 패스워드를 변경한다 -->
		update user set password=#{password} where user_id=#{user_id}
	</update>
	
</mapper>
